# /workspace/yolo/ultralytics/cfg/models/new/yolov12-sod-fusion-v5-E2.yaml
# 作用: 这是为 E2 消融实验定制的 YOLOv5-simple 模型配置。
# E2 目标: 在 E1 的基础上，重新加入 P2 检测头。即“无注意力模块的基础版 + P2检测头”。
# 与 E1 的区别: 包含了完整的 P2 检测路径和对应的检测头。

nc: 10  # 类别数量 (VisDrone 数据集有 10 类)
depth_multiple: 0.33
width_multiple: 0.50
ch: 3   # 输入通道

# E2 主干网络 (Backbone) - 移除了所有注意力模块
backbone:
  # Stage 1
  - [ -1, 1, Conv, [64, 3, 2] ]             # 0: stride 2 conv -> P1/2
  # - [ -1, 1, SE_Block, [64] ]             # E2: REMOVED
  - [ -1, 1, Conv, [128, 3, 2] ]            # 1: -> P2/4
  - [ -1, 3, C2f, [128, True] ]             # 2: CSP block (Backbone P2 output)
  # - [ -1, 1, CBAM_Block, [128, 16] ]      # E2: REMOVED
  - [ -1, 1, Conv, [256, 3, 2] ]            # 3: -> P3/8
  - [ -1, 6, C2f, [256, True] ]             # 4: CSP block (Backbone P3 output)
  - [ -1, 1, Conv, [512, 3, 2] ]            # 5: -> P4/16
  - [ -1, 3, C2f, [512, True] ]             # 6: CSP block (Backbone P4 output)
  # - [ -1, 1, SwinBlock, [4, 7] ]          # E2: REMOVED
  - [ -1, 1, Conv, [1024, 3, 2] ]           # 7: -> P5/32
  - [ -1, 2, C2f, [1024, True] ]            # 8: CSP block
  # - [ -1, 1, A2_Attn, [8, 8] ]            # E2: REMOVED
  - [ -1, 1, SPPF, [1024, 5] ]              # 9: SPPF (Backbone P5 output)

# E2 颈部网络 (Neck) - 移除了所有注意力模块，但保留了 P2 路径
neck:
  # Top-Down path (PANet)
  # P5 -> P4
  - [ -1, 1, Conv, [512, 1, 1] ]                 # 10: reduce channel
  - [ -1, 1, nn.Upsample, [None, 2, 'nearest'] ]  # 11: upsample
  - [ [ -1, 6 ], 1, Concat, [1] ]                 # 12: concat P5 upsampled with P4 from backbone (new layer 6)
  - [ -1, 3, C2f, [512, True] ]                   # 13: fusion at P4
  # - [ -1, 1, CBAM_Block, [512, 16] ]           # E2: REMOVED
  
  # P4 -> P3
  - [ -1, 1, Conv, [256, 1, 1] ]                 # 14: reduce channel
  - [ -1, 1, nn.Upsample, [None, 2, 'nearest'] ]  # 15: upsample
  - [ [ -1, 4 ], 1, Concat, [1] ]                 # 16: concat with P3 from backbone (new layer 4)
  - [ -1, 3, C2f, [256, True] ]                   # 17: fusion at P3
  # - [ -1, 1, SE_Block, [256] ]                 # E2: REMOVED
  
  # P3 -> P2
  - [ -1, 1, Conv, [128, 1, 1] ]                 # 18: reduce channel
  - [ -1, 1, nn.Upsample, [None, 2, 'nearest'] ]  # 19: upsample
  - [ [ -1, 2 ], 1, Concat, [1] ]                 # 20: concat with P2 from backbone (new layer 2)
  - [ -1, 3, C2f, [128, True] ]                   # 21: fusion at P2 (This is the output for the P2 head)
  # - [ -1, 1, SwinBlock, [2, 7] ]               # E2: REMOVED

  # Bottom-Up path
  # P2 -> P3
  - [ 21, 1, Conv, [256, 3, 2] ]                  # 22: downsample P2->P3, input from P2 fusion (layer 21)
  - [ [ -1, 17 ], 1, Concat, [1] ]                # 23: concat with P3 from top-down path (new layer 17)
  - [ -1, 3, C2f, [256, True] ]                   # 24: fusion at P3 (This is the output for the P3 head)
  # - [ -1, 1, CA_Block, [256] ]                  # E2: REMOVED

  # P3 -> P4
  - [ -1, 1, Conv, [512, 3, 2] ]                  # 25: downsample P3->P4
  - [ [ -1, 13 ], 1, Concat, [1] ]                # 26: concat with P4 from top-down path (new layer 13)
  - [ -1, 3, C2f, [512, True] ]                   # 27: fusion at P4 (This is the output for the P4 head)

  # P4 -> P5
  - [ -1, 1, Conv, [1024, 3, 2] ]                 # 28: downsample P4->P5
  - [ [ -1, 9 ], 1, Concat, [1] ]                 # 29: concat with P5 from backbone (new layer 9, after SPPF)
  - [ -1, 2, C2f, [1024, True] ]                  # 30: fusion at P5 (This is the output for the P5 head)

# E2 检测头 (Head) - 使用 P2, P3, P4, P5 四个尺度的输出
head:
  - [ [21, 24, 27, 30], 1, Detect, [nc] ] # Detect from P2(21), P3(24), P4(27), P5(30)